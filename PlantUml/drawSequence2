@startuml

title draw sequence

box "Other threads" #lightgreen
participant "MCU" as MCU
participant  "CommonAPIProxyImpl" as Impl
'eventBuffer 에서 데이터도 같이 가지고 있어야 되는지 아니면 노티만 처리해야 되는지 확인 필요
'데이터를 가지고 있어야 싱크가 맞을거같음 혹은 데이터 아이디 만들기
participant  "eventBuffer" as event
endbox
box "GUI Thread" #lightblue
participant  "OpenGLDrawClass" as GL
endbox

MCU -> Impl : ...callback(ADAS Struct)
Impl -> event : setData()
event ->  event : store data
event -> GL : state check -- (signal)

alt state == READY
GL->event : state is [READY] -- (slot)
event -> event : setCurrentRequestData(data)
event -> event : setnextRequestData(null)
event -> GL : request draw image ()  -- (signal)
GL -> event : get ADAS data()
GL -> GL : set State [DRAWING]
rnote over GL
  화면 그리기
endrnote
GL -> GL : set State [DRAWING Complete]
GL -> event : state is [DRAWING Complete]
event -> event : setCurrentRequestData(NULL)

else state != READY
GL->event : state is [DRAWING]
event -> event : setnextRequestData(data)
...
GL -> event : state is [DRAWING Complete]
event -> event : setCurrentRequestData(NULL)

alt state != next data NULL
event -> event : setCurrentRequestData(NextData)
event -> event : setNextRequestData(NULL)
event -> GL : request draw image ()
GL -> event : get ADAS data()
GL -> GL : set State  [DRAWING]
rnote over GL
  화면 그리기
endrnote
GL -> GL : set State [DRAWING Complete]
GL -> event : state is [DRAWING Complete]
event -> event : setCurrentRequestData(NULL)


else state == next data NULL

end

end

@enduml
