@startuml

title draw sequence

box "Other threads" #lightgreen
participant "MCU" as MCU
participant  "CommonAPIProxyImpl" as Impl
'eventBuffer 에서 데이터도 같이 가지고 있어야 되는지 아니면 노티만 처리해야 되는지 확인 필요
'데이터를 가지고 있어야 싱크가 맞을거같음 혹은 데이터 아이디 만들기
participant  "eventBuffer" as event
endbox
box "GUI Thread" #lightblue
participant  "OpenGLDrawClass" as GL
endbox

MCU -> Impl : ...callback(ADAS Struct)

Impl -> event : setADASInfo()
activate event
event -> event : setNextRequestData(new data)
event -> GL : state check -- (signal or function call)
deactivate event

alt state == READY
GL->event : state is [READY] -- (slot)
activate event

event -> event : setCurrentADASInfo(getNextRequestData())
event -> event : setNextADASInfo(null)
event --> GL : signalRequestGLDraw()
deactivate event
GL -> event : getCurrentADASInfo()
activate GL
GL -> GL : set State [DRAWING]
rnote over GL
  화면 그리기
endrnote
GL -> GL : set State [DRAWING Complete]
GL --> event : signalGLStateChanged(DRAWING Complete)
deactivate GL
activate event
'event -> event :slotReceivedGLState()
event -> event : setCurrentADASInfo(NULL)
else state != READY
deactivate event
GL->event : state is [DRAWING]
'activate event
'event -> event : setnextRequestData(data)
'deactivate event
...
GL -> event : state is [DRAWING Complete]
activate event
event -> event : setCurrentADASInfo(NULL)

alt nextData !=  NULL
event -> event : setCurrentADASInfo(getNextRequestData())
event -> event : setNextRequestData(NULL)
event -> GL : request draw image ()
GL -> event : get ADAS data()
GL -> GL : set State  [DRAWING]
rnote over GL
  화면 그리기
endrnote
GL -> GL : set State [DRAWING Complete]
GL -> event : state is [DRAWING Complete]
event -> event : setCurrentADASInfo(NULL)


else state == next data NULL

end

end

@enduml
